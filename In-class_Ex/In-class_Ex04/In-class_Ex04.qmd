---
title: "In-class Exercise 4: Spatial Weights and Applications"
execute:
  freeze: true
  eval: FALSE
  warning: false
date: "January 29, 2024"
---

# 1 Getting Started

# 1.1 Installing and Loading R Packages

```{r}
pacman::p_load(sf, spdep, tmap, knitr, tidyverse, GWmodel)
```

# 1.2 Importing Data

## 1.2.1 Importing Geospatial Data

```{r}
hunan <- st_read(dsn="data/geospatial",
                 layer = "Hunan")
```

## 1.2.2 Importing Aspatial Data

```{r}
hunan2012 <- read_csv("data/aspatial/Hunan_2012.csv")
```

## 1.2.3 Joining Geospatial and Aspatial Data

```{r}
hunan <- left_join(hunan, hunan2012) %>%
  select(1:4, 7, 15)
```

# 2 Working with Geographically Weighted Summary Statistics

To use the GWmodel package, we must covert hunan sf data frame into sp class.

```{r}
hunan_sp <- hunan %>%
  as_Spatial()
```

Next, we will apply gwstat() of GWmodel package to explore the geographically weighted summary statistics (GWSS) of the GDPPC field in hunan_sp.

```{r}
gwstat <- gwss(data = hunan_sp,
               vars = "GDPPC",
               bw = 6,
               kernel = "bisquare",
               adaptive = TRUE,
               longlat = T)
```

For the code above:

-   As we are using distance-weight matrix, we have to define the bandwidth. Since we are using adaptive distance, the bandwidth would be based on number of neighbours, which is 6 in this case.

-   However, if we are using fixed-distance mathod, adaptive = FALSE, and the bw would be based on distance in kilometers (e.g. 62 km).

-   For non-projected Great Circle distances, longlat = T, while for projected data, longlat = F.

```{r}
gwstat
```
